{% extends 'base.html' %}
{% load static %}
{% load business_type_filter %}
{% block title %}CrowdSourceIt - Payment{% endblock title %}
{% block content %}
<script src="https://js.paystack.co/v1/inline.js"></script>
<form class="mb-4" method="POST" id="payForm" action="{% url 'accounts:make_payment' %}">
    {% csrf_token  %}
    <input type="text" id="hide" style="visibility: hidden;" value="false" name="bool">
    <!-- {% csrf_token %} -->
    <div class="form-group mb-3">
        <div class="h5 mx-5">
            <label for="amount_donated">Amount to Load:</label>
            <input required class="form-control" type="number" name="amount" id="amount" placeholder="Enter the amount needed you want to load.">
        </div>
    </div>
    <div class="text-center">
        <button type="button" onclick="makePayment()" name="load" class="button button-primary button-outline px-5 py-2 text-light font-weight-semi-bold">
            Deposit Money
        </button>
    </div>
</form>
<script>
    // document.getElementById('make-payment-btn').addEventListener('click', makePayment);
    function makePayment(){
        let amount = document.getElementById('amount').value
        console.log(amount)
    // e.preventDefault();
    let handler = PaystackPop.setup({
            key: 'pk_test_94c9c0292b58b03a1e0feaa5b1b1da81b04b0873', //public key from your paystack
            email: '{{ user.email }}',
            amount:`${amount}` * 100,
            currency:'NGN',
            // ref: ''+Math.floor((Math.random() * 100000000) + 1),
            // ref: ''+Math.floor((Math.random() * 1000000000) + 1),
            callback: function(response){
        document.getElementById('hide').value = 'True';
        // document.getElementById('hide').style.visibility = 'visible';
        document.getElementById('payForm').submit();
        alert('Success. Transaction ref is ' +response.reference);
    },
    onClose: function(){
        alert('Window Closed');
    }
    });
    handler.openIframe();
}
// window.onload = makePayment()
</script>
{% endblock content %}