{% extends 'base.html' %}
{% load static %}
{% block title %}Fund or Withdraw{% endblock title %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<div class="container">

{% if status == True %}
<div class="modal" tabindex="-1" id="Modal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Modal body text goes here.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn button-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
{% endif %}  

    <div>
        <!-- <ul class="tabs clearfix">
            <li><a href="#tab-deposit" class="tab-link-active">Deposit</a></li>
            <li><a href="#tab-withdraw">Withdraw</a></li>
        </ul> -->
        <div id="tab-deposit" style="background-color: whitesmoke;padding: 40px;">
            <div class="row">
                <div class="col-12 col-lg-12">
                    <script src="https://js.paystack.co/v1/inline.js"></script>
                    <form class="mb-4" method="POST" id="payForm" action="{% url 'deposit' %}">
                        {% csrf_token %}
                        <input type="text" id="hide" style="visibility: hidden;" value="False" name="bool">
                        <p>To begin investing you need to deposit funds to your Investor Account by making transfer to the bank account stated below. Processing may take up to 2-3 working days. Once deposited funds are added to your Investor Account, you will receive a confirmation e-mail and will be able to make investments.</p>
                        <input type="number" step="0.1" min=0 placeholder="Amount" name="amount" id="amount">
                        <button onclick="makePayment()" name="deposit" type="button">Deposit</button>
                    </form>
                </div>
            </div>
        </div>
        <div id="tab-withdraw">
            <div class="row">
                <div class="col-12 col-lg-12">
                    <form name="withdraw_form" method="POST" action="{% url 'deposit' %}">
                        {% csrf_token %}
                        <div class="data-box">
                            <div class="data-property">Withdraw Amount</div>
                            <div class="data-value"><input name="withdraw_amount" type="number" step="0.1" min=0></div>
                            
                            <div class="data-property">Account Number</div>
                            <div class="data-value"><input name="withdraw_to" type="text"></div>
                            <select id="bank_code" name="bank_code">
                                <option selected>Select Bank</option>
                                {% for bank in banks %}
                                <option value="{{ bank.code }}">{{ bank.name }}</option>
                                {% endfor %}
                            </select>

                            <div class="data-property">Available Funds</div>
                            <div class="data-value">â‚¦ {{ innovator.account_balance }}</div>
                            <div class="data-actions"><button type="submit" name="withdraw">Withdraw</button></div>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
        
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // document.getElementById('make-payment-btn').addEventListener('click', makePayment);
    function makePayment(){
        let amount = document.getElementById('amount').value
    // e.preventDefault();
    let handler = PaystackPop.setup({
            key: 'pk_test_94c9c0292b58b03a1e0feaa5b1b1da81b04b0873', //public key from your paystack
            email: '{{ user.email }}',
            amount:`${amount}` * 100,
            currency:'NGN',
            // ref: ''+Math.floor((Math.random() * 100000000) + 1),
            // ref: ''+Math.floor((Math.random() * 1000000000) + 1),
            callback: function(response){
        document.getElementById('hide').value = 'True';
        
        // document.getElementById('hide').style.visibility = 'visible';
        document.getElementById('payForm').submit();
        alert('Success. Transaction ref is ' +response.reference);
    },
    onClose: function(){
        alert('Window Closed');
    }
    });
    handler.openIframe();
}
// window.onload = makePayment()
</script>

<!-- <script>
    $(document).ready(function() {
      // Listen for the form submission
      $('form[name="withdraw_form"]').submit(function(e) {
        e.preventDefault(); // Prevent the form from submitting the traditional way
  
        // Use AJAX to submit the form data and check for correctness on the server
        $.ajax({
          type: 'POST',
          url: '{% url "deposit" %}',
          data: $(this).serialize(), // Serialize form data
          success: function(response) {
            if (response.is_valid) {
              // Display the modal if the form is valid
            //   window.location.href = '{% url "deposit" %}';
              console.log('YESSIRRRR')
              $('#myModal').modal('show');
            } else {
              // Handle form errors here if needed
              console.log('Form is not valid');
            }
          },
        });
      });
  
      // Trigger the modal when the button is clicked
      $('#myModalBtn').click(function() {
        $('#myModal').modal('show');
      });
    });
  </script> -->
  <script>
    window.onload = function () {
        OpenBootstrapPopup();
    };
    function OpenBootstrapPopup() {
        $("#Modal").modal('show');
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
{% endblock content %}